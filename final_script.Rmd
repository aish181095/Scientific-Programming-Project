---
---
title: "Scientific Programming project"
output: html_document
author:Aishwarya Iyer
date:
---
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r}
#Set up the working directory
DATA.DIR    <- "C:\\Users\\HP\\Desktop\\scientific programming"
RESULTS.DIR <-  "C:\\Users\\HP\\Desktop\\scientific programming"
setwd(DATA.DIR)

##Import imputed dataset
imputed_data_1<-read.csv("imputed data 1.csv")



```{r}
##Merging classes into one 
#imputed data 1
imputed_data_1$Mild_Severity<- 2*(imputed_data_1$Mild_Severity)
imputed_data_1$Moderate_Severity<-3*(imputed_data_1$Moderate_Severity)
imputed_data_1$Severe<-4*(imputed_data_1$Severe)
#combine data
imputed_data_1$class<-as.factor(imputed_data_1$Mild_Severity+imputed_data_1$Moderate_Severity+imputed_data_1$No_Severity+imputed_data_1$Severe)
imputed_data_1$Mild_Severity<-NULL
imputed_data_1$Moderate_Severity<-NULL
imputed_data_1$No_Severity<-NULL
imputed_data_1$Severe<-NULL

```

```{r}
# summarize the class distribution
percentage <- prop.table(table(imputed_data_1$class)) * 100
cbind(freq=table(imputed_data_1$class), percentage=percentage)
library(caret)
set.seed(100)
index <- createDataPartition(imputed_data_1$class, p = 0.7, list = FALSE)
train_data <- imputed_data_1[index, ]
test_data  <- imputed_data_1[-index, ]

set.seed(101)
validation_index<-createDataPartition(train_data$class, p = 0.7, list = FALSE)
train_data <- train_data[validation_index, ]
validation_data  <- train_data[-validation_index, ]


#summarise training dataset labels


percentage <- prop.table(table(train_data$class)) * 100
cbind(freq=table(train_data$class), percentage=percentage)



```
```{r}
# hyperparameter grid search for ranger
hyper_grid_2 <- expand.grid(
  mtry       = c(5),
  node_size  = seq(10,15, by = 2),
  sampe_size = c(1),
  OOB_RMSE=0
  )

# total number of combinations
nrow(hyper_grid_2)

```
# perform grid search
for(i in 1:nrow(hyper_grid_2)) {
  
  # train model
  model_2 <- ranger(
    formula         = class ~ ., 
    data            = train_data, 
    num.trees       = 5000,
    mtry            = hyper_grid_2$mtry[i],
    min.node.size   = hyper_grid_2$node_size[i],
    sample.fraction = hyper_grid_2$sampe_size[i],
    seed            = 124
  )
 # add OOB error to grid
  hyper_grid_2$OOB_RMSE[i] <- sqrt(model_2$prediction.error)
}

hyper_grid %>% 
  dplyr::arrange(OOB_RMSE) %>%
  head(10)
